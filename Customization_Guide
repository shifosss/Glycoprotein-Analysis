# Training Example CPU - Customizable Parameters Guide

## 1. **æ•°æ®é…ç½® (Data Configuration)**

### åŸºç¡€æ•°æ®è®¾ç½®
```python
# å¯è‡ªå®šä¹‰çš„æ•°æ®è·¯å¾„å’Œæ–‡ä»¶
data_path = "data/v12_glycan_binding.csv"  # ğŸ”§ æ‚¨çš„æ•°æ®æ–‡ä»¶è·¯å¾„
vocab_path = "GlycanEmbedder_Package/glycoword_vocab.pkl"  # ğŸ”§ è¯æ±‡è¡¨è·¯å¾„
cache_dir = "cpu_embedding_cache"  # ğŸ”§ ç¼“å­˜ç›®å½•åç§°
```

### æ•°æ®åˆ’åˆ†è®¾ç½®
```python
# create_glycan_dataloaders() ä¸­çš„å‚æ•°
test_size=0.1,     # ğŸ”§ æµ‹è¯•é›†æ¯”ä¾‹ (0.1 = 10%)
val_size=0.1,      # ğŸ”§ éªŒè¯é›†æ¯”ä¾‹ (0.1 = 10%)
max_pairs=300      # ğŸ”§ æœ€å¤§æ ·æœ¬å¯¹æ•°é‡ (None = ä½¿ç”¨å…¨éƒ¨æ•°æ®)
```

### æ•°æ®åˆ—é…ç½®
```python
# GlycanProteinDataLoader åˆå§‹åŒ–ä¸­å¯è‡ªå®šä¹‰
protein_col='target',     # ğŸ”§ è›‹ç™½è´¨IDåˆ—å
sequence_col='target',    # ğŸ”§ è›‹ç™½è´¨åºåˆ—åˆ—å
exclude_cols=None         # ğŸ”§ è¦æ’é™¤çš„åˆ—ååˆ—è¡¨
```

## 2. **æ¨¡å‹é…ç½® (Model Configuration)**

### Embedderé…ç½®
```python
embedder = GlycanProteinPairEmbedder(
    protein_model="650M",                                    # ğŸ”§ "650M" æˆ– "3B"
    protein_model_dir="resources/esm-model-weights",         # ğŸ”§ æ¨¡å‹æƒé‡ç›®å½•
    glycan_method="lstm",                                    # ğŸ”§ ç³–é“¾åµŒå…¥æ–¹æ³•
    glycan_vocab_path=vocab_path,                           # ğŸ”§ ç³–é“¾è¯æ±‡è¡¨è·¯å¾„
    fusion_method="concat",                                  # ğŸ”§ èåˆæ–¹æ³•
    device=device                                           # ğŸ”§ è®¾å¤‡è®¾ç½®
)
```

#### ğŸ”§ **Glycan Method é€‰é¡¹ï¼š**
- `"gcn"` - Graph Convolutional Network
- `"lstm"` - Long Short-Term Memory
- `"bert"` - BERT-like Transformer
- `"cnn"` - Convolutional Neural Network
- `"rgcn"` - Relational Graph Convolutional Network
- `"gat"` - Graph Attention Network
- `"gin"` - Graph Isomorphism Network

#### ğŸ”§ **Fusion Method é€‰é¡¹ï¼š**
- `"concat"` - ç®€å•æ‹¼æ¥
- `"attention"` - æ³¨æ„åŠ›æœºåˆ¶èåˆ

### ç¥ç»ç½‘ç»œé…ç½®
```python
predictor = PyTorchBindingPredictor(
    embedder=embedder,
    network_type="mlp",                    # ğŸ”§ ç½‘ç»œç±»å‹
    network_config={                       # ğŸ”§ ç½‘ç»œé…ç½®å­—å…¸
        "hidden_dims": [1024, 512, 256, 128],  # ğŸ”§ éšè—å±‚ç»´åº¦
        "dropout": 0.3,                         # ğŸ”§ Dropoutæ¯”ä¾‹
        "activation": "relu",                   # ğŸ”§ æ¿€æ´»å‡½æ•°
        "batch_norm": True                      # ğŸ”§ æ˜¯å¦ä½¿ç”¨BatchNorm
    },
    device=device
)
```

#### ğŸ”§ **Network Type é€‰é¡¹ï¼š**
- `"mlp"` - Multi-Layer Perceptron
- `"resnet"` - Residual Network
- `"attention"` - Attention-based Network
- å…¶ä»– binding_strength_networks ä¸­å®šä¹‰çš„ç±»å‹

#### ğŸ”§ **Network Config å¯é€‰å‚æ•°ï¼š**
```python
network_config = {
    "hidden_dims": [512, 256, 128, 64],        # ğŸ”§ éšè—å±‚å°ºå¯¸åˆ—è¡¨
    "dropout": 0.2,                            # ğŸ”§ 0.0-1.0
    "activation": "gelu",                      # ğŸ”§ "relu", "gelu", "tanh", "sigmoid"
    "batch_norm": False,                       # ğŸ”§ True/False
    "layer_norm": True,                        # ğŸ”§ True/False (å¦‚æœæ”¯æŒ)
    "residual_connections": True,              # ğŸ”§ True/False (å¦‚æœæ”¯æŒ)
    "num_heads": 8,                           # ğŸ”§ æ³¨æ„åŠ›å¤´æ•° (attentionç½‘ç»œ)
    "num_layers": 4                           # ğŸ”§ å±‚æ•° (éƒ¨åˆ†ç½‘ç»œç±»å‹)
}
```

## 3. **è®­ç»ƒé…ç½® (Training Configuration)**

### åŸºç¡€è®­ç»ƒå‚æ•°
```python
history = predictor.train(
    dataloaders=dataloaders,
    num_epochs=50,              # ğŸ”§ è®­ç»ƒè½®æ•°
    learning_rate=2e-3,         # ğŸ”§ å­¦ä¹ ç‡ (1e-4 åˆ° 1e-2)
    weight_decay=1e-4,          # ğŸ”§ æƒé‡è¡°å‡ (0 åˆ° 1e-3)
    patience=15                 # ğŸ”§ æ—©åœè€å¿ƒå€¼
)
```

### ä¼˜åŒ–å™¨å’Œè°ƒåº¦å™¨ (åœ¨PyTorchBindingPredictor.train()ä¸­)
```python
# å¯ä»¥ä¿®æ”¹ä¼˜åŒ–å™¨ç±»å‹
self.optimizer = optim.AdamW(        # ğŸ”§ å¯æ”¹ä¸º SGD, Adam, RMSpropç­‰
    self.model.parameters(),
    lr=learning_rate,
    weight_decay=weight_decay,
    betas=(0.9, 0.999),              # ğŸ”§ AdamWçš„betaå‚æ•°
    eps=1e-8                         # ğŸ”§ æ•°å€¼ç¨³å®šæ€§å‚æ•°
)

# å¯ä»¥ä¿®æ”¹å­¦ä¹ ç‡è°ƒåº¦å™¨
self.scheduler = optim.lr_scheduler.ReduceLROnPlateau(
    self.optimizer,
    patience=patience // 2,          # ğŸ”§ è°ƒåº¦å™¨è€å¿ƒå€¼
    factor=0.5,                      # ğŸ”§ å­¦ä¹ ç‡è¡°å‡å› å­
    verbose=True,                    # ğŸ”§ æ˜¯å¦æ‰“å°ä¿¡æ¯
    min_lr=1e-6                      # ğŸ”§ æœ€å°å­¦ä¹ ç‡
)
```

### æŸå¤±å‡½æ•°
```python
# åœ¨ PyTorchBindingPredictor.__init__() ä¸­
self.criterion = nn.MSELoss()        # ğŸ”§ å¯æ”¹ä¸º L1Loss, SmoothL1Loss, HuberLossç­‰
```

## 4. **æ€§èƒ½å’Œèµ„æºé…ç½® (Performance Configuration)**

### DataLoaderè®¾ç½®
```python
batch_size = 32                      # ğŸ”§ æ‰¹æ¬¡å¤§å° (8, 16, 32, 64, 128...)
embedding_batch_size = 16            # ğŸ”§ åµŒå…¥è®¡ç®—æ‰¹æ¬¡å¤§å°
num_workers = 0                      # ğŸ”§ æ•°æ®åŠ è½½è¿›ç¨‹æ•° (é€šå¸¸0-4)
```

### è®¾å¤‡é…ç½®
```python
device = "cuda" if torch.cuda.is_available() else "cpu"  # ğŸ”§ å¯å¼ºåˆ¶æŒ‡å®š "cpu" æˆ– "cuda:0"
```

### å†…å­˜ç®¡ç†
```python
# åœ¨ DataLoader åˆ›å»ºä¸­
pin_memory=(self.device != "cpu")    # ğŸ”§ æ˜¯å¦ä½¿ç”¨pin_memoryåŠ é€ŸCPU->GPUä¼ è¾“
```

## 5. **é«˜çº§Embedderé…ç½®**

### è‡ªå®šä¹‰Glycan Embedderå‚æ•°
```python
embedder = GlycanProteinPairEmbedder(
    # ... åŸºç¡€å‚æ•° ...
    glycan_hidden_dims=[512, 256, 1280],     # ğŸ”§ ç³–é“¾åµŒå…¥å™¨éšè—å±‚
    glycan_readout="mean",                   # ğŸ”§ "mean", "max", "sum", "dual"
    glycan_custom_params={                   # ğŸ”§ è‡ªå®šä¹‰å‚æ•°å­—å…¸
        'short_cut': True,                   # ğŸ”§ æ˜¯å¦ä½¿ç”¨æ®‹å·®è¿æ¥
        'batch_norm': True,                  # ğŸ”§ æ˜¯å¦ä½¿ç”¨æ‰¹å½’ä¸€åŒ–
        'activation': 'relu',                # ğŸ”§ æ¿€æ´»å‡½æ•°
        'dropout': 0.1,                      # ğŸ”§ Dropoutæ¯”ä¾‹
        'num_heads': 8,                      # ğŸ”§ æ³¨æ„åŠ›å¤´æ•°(BERT/GAT)
        'num_layers': 6,                     # ğŸ”§ å±‚æ•°
        'bidirectional': True,               # ğŸ”§ åŒå‘LSTM
        'kernel_size': 3,                    # ğŸ”§ CNNå·ç§¯æ ¸å¤§å°
        'eps': 0.1,                          # ğŸ”§ GINçš„epså‚æ•°
        'learn_eps': True                    # ğŸ”§ æ˜¯å¦å­¦ä¹ eps
    }
)
```

## 6. **è¾“å‡ºå’Œå¯è§†åŒ–é…ç½®**

### æ—¥å¿—çº§åˆ«
```python
logging.basicConfig(level=logging.INFO)     # ğŸ”§ DEBUG, INFO, WARNING, ERROR
```

### è¿›åº¦æ¡å’Œè¾“å‡º
```python
# åœ¨è®­ç»ƒå¾ªç¯ä¸­å¯è‡ªå®šä¹‰è¾“å‡ºé¢‘ç‡
if epoch % 5 == 0 or epoch == num_epochs - 1:    # ğŸ”§ æ¯5è½®è¾“å‡ºä¸€æ¬¡ (å¯è°ƒæ•´)
    logger.info(...)
```

### å›¾è¡¨ä¿å­˜
```python
plt.savefig("cpu_pytorch_pipeline_results.png",  # ğŸ”§ ä¿å­˜æ–‡ä»¶å
           dpi=300,                               # ğŸ”§ å›¾åƒåˆ†è¾¨ç‡
           bbox_inches='tight')                   # ğŸ”§ è¾¹æ¡†è®¾ç½®
```

## 7. **æ•°æ®é¢„å¤„ç†é…ç½®**

### æ•°æ®æ ‡å‡†åŒ–
```python
normalize_targets=True                       # ğŸ”§ æ˜¯å¦æ ‡å‡†åŒ–ç›®æ ‡å€¼
```

### æ•°æ®é‡‡æ ·
```python
# åœ¨ create_pairs_dataset ä¸­
random_state=42                              # ğŸ”§ éšæœºç§å­
```

## 8. **å®Œæ•´è‡ªå®šä¹‰ç¤ºä¾‹**

```python
def run_custom_pipeline():
    """è‡ªå®šä¹‰é…ç½®çš„å®Œæ•´ç¤ºä¾‹"""

    # ğŸ”§ è‡ªå®šä¹‰æ‰€æœ‰ä¸»è¦å‚æ•°
    CONFIG = {
        # æ•°æ®é…ç½®
        'data_path': "data/my_custom_data.csv",
        'vocab_path': "my_custom_vocab.pkl",
        'test_size': 0.15,
        'val_size': 0.15,
        'max_pairs': 1000,

        # æ¨¡å‹é…ç½®
        'protein_model': "3B",
        'glycan_method': "bert",
        'fusion_method': "attention",
        'network_type': "resnet",
        'hidden_dims': [2048, 1024, 512, 256],

        # è®­ç»ƒé…ç½®
        'batch_size': 64,
        'num_epochs': 100,
        'learning_rate': 1e-3,
        'weight_decay': 1e-5,
        'patience': 20,

        # æ€§èƒ½é…ç½®
        'device': "cuda:0",
        'num_workers': 2,
        'cache_dir': "custom_cache"
    }

    # ä½¿ç”¨è‡ªå®šä¹‰é…ç½®...
    embedder = GlycanProteinPairEmbedder(
        protein_model=CONFIG['protein_model'],
        glycan_method=CONFIG['glycan_method'],
        fusion_method=CONFIG['fusion_method'],
        # ... å…¶ä»–å‚æ•°
    )

    # ... ç»§ç»­è‡ªå®šä¹‰æµç¨‹
```

## 9. **å¸¸ç”¨è‡ªå®šä¹‰ç»„åˆæ¨è**

### å¿«é€ŸåŸå‹ (Fast Prototyping)
```python
small_config = {
    'max_pairs': 500,
    'batch_size': 16,
    'num_epochs': 20,
    'hidden_dims': [256, 128, 64]
}
```

### é«˜æ€§èƒ½è®­ç»ƒ (High Performance)
```python
performance_config = {
    'protein_model': "3B",
    'glycan_method': "bert",
    'fusion_method': "attention",
    'batch_size': 128,
    'hidden_dims': [2048, 1024, 512, 256, 128],
    'num_epochs': 200
}
```

### å†…å­˜å—é™ (Memory Limited)
```python
memory_safe_config = {
    'batch_size': 8,
    'embedding_batch_size': 4,
    'hidden_dims': [512, 256, 128],
    'protein_model': "650M"
}
```